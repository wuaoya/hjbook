<!DOCTYPE html>
<html lang="zh-cn">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta name="renderer" content="webkit">
    <title></title>
    <link rel="stylesheet" href="css/pintuer.css">
    <link rel="stylesheet" href="css/admin.css">
    <script src="js/jquery.js"></script>
    <script src="js/pintuer.js"></script>
    <script src="http://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>
    <script type="text/javascript">
        var path = "http://127.0.0.1:8080";
        //获取所有书籍来渲染列表
        function getBookId(){
            $.get(
                path+"/book/selectAllBook",
                function (data) {
                    var book = data.data;
                    if(data.code == 200){
                        $.each(book,function(i,obj){
                            $("#test").append(
                                '<option value='+
                                obj.id +
                                '>'+obj.bookName+'</option>'
                            );
                        });
                    }
                }
            );
        }
        function getEditInfo() {
            //获取章节信息
            getBookId();
            var url = location.search; //获取url中"?"符后的字串
            var editChapterId = url.substr(1).split("=")[1];
            $.get(
                path+"/chapter/selectById",
                {"chapterId":editChapterId},
                function (data) {
                    if(data.code == 200){
                        var info = data.data;
                        editChapter(info);
                    }
                }
            );
        }
        //渲染全部数据
        function editChapter(info){
            $("#test").find("option[value = '"+info.test+"']").attr("selected","selected");
            $('#chapterName').val(info.chapterName),
            $('#chapterContent').html(info.chapterContent)
        }

        //修改数据
        function edit() {
            var url = location.search; //获取url中"?"符后的字串
            var editChapterId = url.substr(1).split("=")[1];
            var bookId = $("#test option:selected").val();
                var myform = {
                    "id": editChapterId,
                    "test": bookId,
                    "chapterName": $('#chapterName').val(),
                    "chapterContent": $('#chapterContent').html()
                };

                $.ajax({
                    url: path+"/chapter/modify",
                    type: "POST",
                    data: JSON.stringify(myform),
                    contentType: "application/json",
                    dataType:"json",
                    beforeSend:function () {
                    },
                    success:function (data) {
                        if(data.code == 200){
                            window.location.href = path + "/background/list-product.html";
                        }
                    },
                    error:function () {
                        alert("编辑书籍失败！");
                    }

                });
        }


    </script>

<body onload="getEditInfo()">
<div class="panel admin-panel">
    <div class="panel-head"><strong class="icon-reorder">编辑章节</strong></div>
    <div class="panel admin-panel margin-top" id="add">
        <div class="panel-head"><strong><span class="icon-pencil-square-o"></span>编辑信息</strong></div>
        <div class="body-content">
            <div class="form-x" >
                <div class="form-group">
                    <div class="label">
                        <label>书籍编号：</label>
                    </div>
                    <div class="field">
                        <select id="test" name="test" class="input w50" >
                            <option  value="">请选择书籍</option>
                        </select>
                        <div class="tips"></div>
                    </div>
                </div>
                <div class="form-group">
                    <div class="label">
                        <label>章节名称：</label>
                    </div>
                    <div class="field">
                        <input type="text" class="input w50" name="chapterName" id="chapterName" data-validate="required:请填写章节名称"  />
                        <div class="tips"></div>
                    </div>
                </div>
                <div class="form-group">
                    <div class="label">
                        <label>章节内容：</label>
                    </div>
                </div>
                <div contenteditable="true"  style="padding: 0px;">
                    <table  style="width: 90%;">
                        <tbody>
                        <tr>
                            <td style="background:url(./images/a_01.jpg) no-repeat #f6ffec; min-height:550px; padding: 100px 55px 200px; ">
                                <div id="chapterContent" class="chapterContent"><br></div>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>

                <div class="form-group">
                    <div class="label">
                        <label></label>
                    </div>
                    <div class="field">
                        <button class="button bg-main icon-check-square-o" type="submit" onclick="edit()"> 提交</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</body>
</html>